angular.module("hack.authService",[]).factory("Auth",["$http","$location","$window",function(a,b,c){var d=function(b){return a({method:"POST",url:"/api/users/signin",data:b}).then(function(a){return a.data})},e=function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return a.data})},f=function(){return!!c.localStorage.getItem("com.hack")},g=function(){c.localStorage.removeItem("com.hack")};return{signin:d,signup:e,isAuth:f,signout:g}}]),angular.module("hack.bookmarkService",[]).factory("Bookmarks",["$http","$window",function(a,b){var c=[],d=b.localStorage.getItem("com.hack"),e=function(b){var e={points:b.points,url:b.url,title:b.title,author:b.author,created_at:b.created_at,objectID:b.objectID,num_comments:b.num_comments},f={username:d,bookmark:e};a({method:"POST",url:"/api/bookmarks/addBookmark",data:f}),-1===c.indexOf(e.objectID)&&c.push(e.objectID)},f=function(b){var e={objectID:b.objectID},f={username:d,bookmark:e};a({method:"POST",url:"/api/bookmarks/removeBookmark",data:f});var g=c.indexOf(e.objectID);c.splice(g,1)};return{bookmarks:c,addBookmark:e,removeBookmark:f}}]),angular.module("hack.followService",[]).factory("Followers",["$http","$window",function(a,b){var c=[],d=function(){var c=b.localStorage.getItem("com.hack");if(c){var d={username:c,following:g()};a({method:"POST",url:"/api/users/updateFollowing",data:d})}},e=function(a){var e=g();e.includes(a)||-1!==c.indexOf(a)||(e+=","+a,b.localStorage.setItem("hfUsers",e),c.push(a)),d()},f=function(a){var e=g();e.includes(a)&&c.indexOf(a)>-1&&(c.splice(c.indexOf(a),1),e=e.split(","),e.splice(e.indexOf(a),1).join(","),b.localStorage.setItem("hfUsers",e)),d()},g=function(){return b.localStorage.getItem("hfUsers")},h=function(){g()||b.localStorage.setItem("hfUsers","pg,sama");var a=g().split(",");c.splice(0,c.length),c.push.apply(c,a)},i=function(){h()};return i(),{following:c,addFollower:e,removeFollower:f,localToArr:h}}]),angular.module("hack.linkService",[]).factory("Links",["$window","$http","$interval","Followers",function(a,b,c,d){var e=[],f=[],g=[],h=[],i=function(){console.log("getTopStories");var a="/api/cache/topStories";return b({method:"GET",url:a}).then(function(a){f.splice(0,f.length),f.push.apply(f,a.data)})},j=function(a){console.log("getTopStoriesWithKeyword");var c="/api/cache/topStoriesWithKeyword";return b({method:"GET",url:c,params:{keyword:a}}).then(function(a){console.log(a),h.splice(0,h.length),h.push.apply(h,a.data),console.log(h)})},k=function(a){var c="http://hn.algolia.com/api/v1/search_by_date?hitsPerPage=500&tagFilters=(story,comment),(",d=m(a);return c+=d+")",b({method:"GET",url:c}).then(function(a){angular.forEach(a.data.hits,function(a){null===a.title&&(a.isComment=!0)}),e.splice(0,e.length),e.push.apply(e,a.data.hits)})},l=function(){var c=a.localStorage.getItem("com.hack"),d={username:c};return b({method:"POST",url:"/api/bookmarks/getBookmarks",data:d}).then(function(a){g.splice(0,g.length),angular.forEach(a.data,function(a){g.push(a)})})},m=function(a){for(var b=[],c=0;c<a.length;c++)b.push("author_"+a[c]);return b.join(",")},n=function(){k(d.following),c(function(){k(d.following),i()},3e5)};return n(),{getTopStories:i,getTopStoriesWithKeyword:j,getPersonalStories:k,personalStories:e,topStories:f,topStoriesWithKeyword:h,getBookmarks:l,bookmarkStories:g}}]),angular.module("hack.auth",[]).controller("AuthController",["$scope","$window","$location","Auth","Followers","Bookmarks",function(a,b,c,d,e,f){a.user={},a.newUser={},a.loggedIn=d.isAuth(),a.signin=function(){d.signin(a.user).then(function(c,d){b.localStorage.setItem("com.hack",a.user.username),b.localStorage.setItem("hfBookmarks",d),b.localStorage.setItem("hfUsers",c),e.localToArr(),f.localToArr(),a.loggedIn=!0,a.user={}})["catch"](function(a){console.error(a)})},a.signup=function(){a.newUser.following=e.following.join(","),d.signup(a.newUser).then(function(c){b.localStorage.setItem("com.hack",a.newUser.username),a.loggedIn=!0,a.newUser={}})["catch"](function(a){console.error(a)})},a.logout=function(){d.signout(),a.loggedIn=!1}}]),angular.module("hack.currentlyFollowing",[]).controller("CurrentlyFollowingController",["$scope","Followers",function(a,b){a.currentlyFollowing=b.following,a.unfollow=function(a){b.removeFollower(a)},a.follow=function(c){b.addFollower(c),a.newFollow=""}}]),angular.module("hack.personal",[]).controller("PersonalController",["$scope","$window","Links","Followers","Auth","Bookmarks",function(a,b,c,d,e,f){a.stories=c.personalStories,a.users=d.following,a.perPage=30,a.index=a.perPage,a.loggedIn=e.isAuth(),a.isBookmark=function(a){return-1===f.bookmarks.indexOf(a.objectID)?!1:!0},a.addBookmark=function(a){f.addBookmark(a)},a.removeBookmark=function(a){f.removeBookmark(a)};var g=function(){h()},h=function(){c.getPersonalStories(a.users)};g()}]),angular.module("hack.bookmarks",[]).controller("BookmarksController",["$scope","$window","Links","Followers","Bookmarks","Auth",function(a,b,c,d,e,f){a.currentBookmarks=e.bookmarks,a.loggedIn=f.isAuth(),a.stories=c.bookmarkStories,a.perPage=30,a.index=a.perPage,a.currentlyFollowing=d.following,a.addUser=function(a){d.addFollower(a)};var g=function(){c.getBookmarks()};g()}]),angular.module("hack.tabs",[]).controller("TabsController",["$scope","$location","$window","Links","Followers",function(a,b,c,d,e){var f=c.location.hash.split("/")[1];f=f?f:"all",a.currentTab=f,a.angle=360,a.changeTab=function(c){a.currentTab=c,b.path(c)},a.refresh=function(){d.getTopStories(),d.getPersonalStories(e.following),a.angle+=360}}]),angular.module("hack.topStories",[]).controller("TopStoriesController",["$scope","$window","Links","Followers","Bookmarks","Auth",function(a,b,c,d,e,f){angular.extend(a,c),a.stories=c.topStories,a.perPage=30,a.index=a.perPage,a.loggedIn=f.isAuth(),a.currentlyFollowing=d.following,a.getData=function(){c.getTopStories()},a.addUser=function(a){d.addFollower(a)},a.isBookmark=function(a){return-1===e.bookmarks.indexOf(a.objectID)?!1:!0},a.addBookmark=function(a){e.addBookmark(a)},a.removeBookmark=function(a){e.removeBookmark(a)},a.getData()}]),angular.module("hack.topStoriesWithKeyword",[]).controller("TopStoriesWithKeywordController",["$scope","$window","Links","Followers",function(a,b,c,d){angular.extend(a,c),a.stories=c.topStoriesWithKeyword,a.perPage=30,a.index=a.perPage,a.keyword,a.checked="start",a.currentlyFollowing=d.following,a.getData=function(){c.getTopStoriesWithKeyword(a.keyword)},a.addUser=function(a){d.addFollower(a)},a.getData("")}]),angular.module("hack",["hack.topStories","hack.topStoriesWithKeyword","hack.personal","hack.bookmarks","hack.bookmarkService","hack.currentlyFollowing","hack.linkService","hack.authService","hack.followService","hack.tabs","hack.auth","ngRoute"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"app/topStories/topStories.html",controller:"TopStoriesController"}).when("/personal",{templateUrl:"app/personal/personal.html",controller:"PersonalController"}).when("/bookmarks",{templateUrl:"app/bookmarks/bookmarks.html",controller:"BookmarksController"}).when("/keyword",{templateUrl:"app/topStoriesWithKeyword/topStoriesWithKeyword.html",controller:"TopStoriesWithKeywordController"}).otherwise({redirectTo:"/"})}]).filter("fromNow",function(){return function(a){return humanized_time_span(new Date(a))}}).filter("htmlsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).directive("rotate",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.degrees,function(a){var c="rotate("+a+"deg)";b.css({"-moz-transform":c,"-webkit-transform":c,"-o-transform":c,"-ms-transform":c,transform:c})})}}});